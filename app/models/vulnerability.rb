class Vulnerability < ApplicationRecord
  validates :cve, uniqueness: { scope: [:date, :rubygem, :title] }

  after_create :send_messages

  private

  def send_messages
    User.all.each do |user|
      VulnerabilityMailer.with(user: user, vulnerability: self).vulnerability.deliver_now
    end
  end
end
